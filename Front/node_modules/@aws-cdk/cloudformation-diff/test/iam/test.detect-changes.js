"use strict";
const lib_1 = require("../../lib");
const util_1 = require("../util");
module.exports = {
    'shows new AssumeRolePolicyDocument'(test) {
        // WHEN
        const diff = lib_1.diffTemplate({}, util_1.template({
            MyRole: util_1.role({
                AssumeRolePolicyDocument: util_1.poldoc({
                    Action: 'sts:AssumeRole',
                    Effect: 'Allow',
                    Principal: { Service: 'lambda.amazonaws.com' }
                })
            })
        }));
        // THEN
        test.deepEqual(diff.iamChanges.toJson(), {
            statementAdditions: [
                {
                    effect: 'Allow',
                    resources: { not: false, values: ['${MyRole.Arn}'] },
                    principals: { not: false, values: ['Service:lambda.amazonaws.com'] },
                    actions: { not: false, values: ['sts:AssumeRole'] },
                }
            ]
        });
        test.done();
    },
    'implicitly knows principal of identity policy for all resource types'(test) {
        for (const attr of ['Roles', 'Users', 'Groups']) {
            // WHEN
            const diff = lib_1.diffTemplate({}, util_1.template({
                MyPolicy: util_1.policy({
                    [attr]: [{ Ref: 'MyRole' }],
                    PolicyDocument: util_1.poldoc({
                        Effect: 'Allow',
                        Action: 's3:DoThatThing',
                        Resource: '*'
                    })
                })
            }));
            // THEN
            test.deepEqual(diff.iamChanges.toJson(), {
                statementAdditions: [
                    {
                        effect: 'Allow',
                        resources: { not: false, values: ['*'] },
                        principals: { not: false, values: ['AWS:${MyRole}'] },
                        actions: { not: false, values: ['s3:DoThatThing'] },
                    }
                ]
            });
        }
        test.done();
    },
    'policies on an identity object'(test) {
        for (const resourceType of ['Role', 'User', 'Group']) {
            // WHEN
            const diff = lib_1.diffTemplate({}, util_1.template({
                MyIdentity: util_1.resource(`AWS::IAM::${resourceType}`, {
                    Policies: [
                        {
                            PolicyName: 'Polly',
                            PolicyDocument: util_1.poldoc({
                                Effect: 'Allow',
                                Action: 's3:DoThatThing',
                                Resource: '*'
                            })
                        }
                    ],
                })
            }));
            // THEN
            test.deepEqual(diff.iamChanges.toJson(), {
                statementAdditions: [
                    {
                        effect: 'Allow',
                        resources: { not: false, values: ['*'] },
                        principals: { not: false, values: ['AWS:${MyIdentity}'] },
                        actions: { not: false, values: ['s3:DoThatThing'] },
                    }
                ]
            });
        }
        test.done();
    },
    'if policy is attached to multiple roles all are shown'(test) {
        // WHEN
        const diff = lib_1.diffTemplate({}, util_1.template({
            MyPolicy: util_1.policy({
                Roles: [{ Ref: 'MyRole' }, { Ref: 'ThyRole' }],
                PolicyDocument: util_1.poldoc({
                    Effect: 'Allow',
                    Action: 's3:DoThatThing',
                    Resource: '*'
                })
            })
        }));
        // THEN
        test.deepEqual(diff.iamChanges.toJson(), {
            statementAdditions: [
                {
                    effect: 'Allow',
                    resources: { not: false, values: ['*'] },
                    principals: { not: false, values: ['AWS:${MyRole}'] },
                    actions: { not: false, values: ['s3:DoThatThing'] },
                },
                {
                    effect: 'Allow',
                    resources: { not: false, values: ['*'] },
                    principals: { not: false, values: ['AWS:${ThyRole}'] },
                    actions: { not: false, values: ['s3:DoThatThing'] },
                },
            ]
        });
        test.done();
    },
    'correctly parses Lambda permissions'(test) {
        // WHEN
        const diff = lib_1.diffTemplate({}, util_1.template({
            MyPermission: util_1.resource('AWS::Lambda::Permission', {
                Action: 'lambda:InvokeFunction',
                FunctionName: { Ref: 'MyFunction' },
                Principal: 's3.amazonaws.com',
                SourceAccount: { Ref: 'AWS::AccountId' },
                SourceArn: { 'Fn::GetAtt': ['MyBucketF68F3FF0', 'Arn'] },
            })
        }));
        // THEN
        test.deepEqual(diff.iamChanges.toJson(), {
            statementAdditions: [
                {
                    effect: 'Allow',
                    resources: { not: false, values: ['${MyFunction}'] },
                    principals: { not: false, values: ['Service:s3.amazonaws.com'] },
                    actions: { not: false, values: ['lambda:InvokeFunction'] },
                    condition: {
                        StringEquals: { 'AWS:SourceAccount': '${AWS::AccountId}' },
                        ArnLike: { 'AWS:SourceArn': '${MyBucketF68F3FF0.Arn}' }
                    },
                }
            ]
        });
        test.done();
    },
    'implicitly knows resource of (queue) resource policy even if * given'(test) {
        // WHEN
        const diff = lib_1.diffTemplate({}, util_1.template({
            QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
                Queues: [{ Ref: 'MyQueue' }],
                PolicyDocument: util_1.poldoc({
                    Effect: 'Allow',
                    Action: 'sqs:SendMessage',
                    Resource: '*',
                    Principal: { Service: 'sns.amazonaws.com' }
                })
            })
        }));
        // THEN
        test.deepEqual(diff.iamChanges.toJson(), {
            statementAdditions: [
                {
                    effect: 'Allow',
                    resources: { not: false, values: ['${MyQueue}'] },
                    principals: { not: false, values: ['Service:sns.amazonaws.com'] },
                    actions: { not: false, values: ['sqs:SendMessage'] },
                }
            ]
        });
        test.done();
    },
    'finds sole statement removals'(test) {
        // WHEN
        const diff = lib_1.diffTemplate(util_1.template({
            BucketPolicy: util_1.resource('AWS::S3::BucketPolicy', {
                Bucket: { Ref: 'MyBucket' },
                PolicyDocument: util_1.poldoc({
                    Effect: 'Allow',
                    Action: 's3:PutObject',
                    Resource: '*',
                    Principal: { AWS: 'me' }
                })
            })
        }), {});
        // THEN
        test.deepEqual(diff.iamChanges.toJson(), {
            statementRemovals: [
                {
                    effect: 'Allow',
                    resources: { not: false, values: ['${MyBucket}'] },
                    principals: { not: false, values: ['AWS:me'] },
                    actions: { not: false, values: ['s3:PutObject'] },
                }
            ]
        });
        test.done();
    },
    'finds one of many statement removals'(test) {
        // WHEN
        const diff = lib_1.diffTemplate(util_1.template({
            BucketPolicy: util_1.resource('AWS::S3::BucketPolicy', {
                Bucket: { Ref: 'MyBucket' },
                PolicyDocument: util_1.poldoc({
                    Effect: 'Allow',
                    Action: 's3:PutObject',
                    Resource: '*',
                    Principal: { AWS: 'me' }
                }, {
                    Effect: 'Allow',
                    Action: 's3:LookAtObject',
                    Resource: '*',
                    Principal: { AWS: 'me' }
                })
            })
        }), util_1.template({
            BucketPolicy: util_1.resource('AWS::S3::BucketPolicy', {
                Bucket: { Ref: 'MyBucket' },
                PolicyDocument: util_1.poldoc({
                    Effect: 'Allow',
                    Action: 's3:LookAtObject',
                    Resource: '*',
                    Principal: { AWS: 'me' }
                })
            })
        }));
        // THEN
        test.deepEqual(diff.iamChanges.toJson(), {
            statementRemovals: [
                {
                    effect: 'Allow',
                    resources: { not: false, values: ['${MyBucket}'] },
                    principals: { not: false, values: ['AWS:me'] },
                    actions: { not: false, values: ['s3:PutObject'] },
                }
            ]
        });
        test.done();
    },
    'finds policy attachments'(test) {
        // WHEN
        const diff = lib_1.diffTemplate({}, util_1.template({
            SomeRole: util_1.resource('AWS::IAM::Role', {
                ManagedPolicyArns: ['arn:policy'],
            })
        }));
        // THEN
        test.deepEqual(diff.iamChanges.toJson(), {
            managedPolicyAdditions: [
                {
                    identityArn: '${SomeRole}',
                    managedPolicyArn: 'arn:policy'
                }
            ]
        });
        test.done();
    },
    'finds policy removals'(test) {
        // WHEN
        const diff = lib_1.diffTemplate(util_1.template({
            SomeRole: util_1.resource('AWS::IAM::Role', {
                ManagedPolicyArns: ['arn:policy', 'arn:policy2'],
            })
        }), util_1.template({
            SomeRole: util_1.resource('AWS::IAM::Role', {
                ManagedPolicyArns: ['arn:policy2'],
            })
        }));
        // THEN
        test.deepEqual(diff.iamChanges.toJson(), {
            managedPolicyRemovals: [
                {
                    identityArn: '${SomeRole}',
                    managedPolicyArn: 'arn:policy'
                }
            ]
        });
        test.done();
    },
    'queuepolicy queue change counts as removal+addition'(test) {
        // WHEN
        const diff = lib_1.diffTemplate(util_1.template({
            QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
                Queues: [{ Ref: 'MyQueue1' }],
                PolicyDocument: util_1.poldoc({
                    Effect: 'Allow',
                    Action: 'sqs:SendMessage',
                    Resource: '*',
                    Principal: { Service: 'sns.amazonaws.com' }
                })
            })
        }), util_1.template({
            QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
                Queues: [{ Ref: 'MyQueue2' }],
                PolicyDocument: util_1.poldoc({
                    Effect: 'Allow',
                    Action: 'sqs:SendMessage',
                    Resource: '*',
                    Principal: { Service: 'sns.amazonaws.com' }
                })
            })
        }));
        // THEN
        test.deepEqual(diff.iamChanges.toJson(), {
            statementAdditions: [
                {
                    effect: 'Allow',
                    resources: { not: false, values: ['${MyQueue2}'] },
                    principals: { not: false, values: ['Service:sns.amazonaws.com'] },
                    actions: { not: false, values: ['sqs:SendMessage'] },
                }
            ],
            statementRemovals: [
                {
                    effect: 'Allow',
                    resources: { not: false, values: ['${MyQueue1}'] },
                    principals: { not: false, values: ['Service:sns.amazonaws.com'] },
                    actions: { not: false, values: ['sqs:SendMessage'] },
                }
            ]
        });
        test.done();
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5kZXRlY3QtY2hhbmdlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRlc3QuZGV0ZWN0LWNoYW5nZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLG1DQUF5QztBQUN6QyxrQ0FBbUU7QUFFbkUsaUJBQVM7SUFDUCxvQ0FBb0MsQ0FBQyxJQUFVO1FBQzdDLE9BQU87UUFDUCxNQUFNLElBQUksR0FBRyxrQkFBWSxDQUFDLEVBQUUsRUFBRSxlQUFRLENBQUM7WUFDckMsTUFBTSxFQUFFLFdBQUksQ0FBQztnQkFDWCx3QkFBd0IsRUFBRSxhQUFNLENBQUM7b0JBQy9CLE1BQU0sRUFBRSxnQkFBZ0I7b0JBQ3hCLE1BQU0sRUFBRSxPQUFPO29CQUNmLFNBQVMsRUFBRSxFQUFFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRTtpQkFDL0MsQ0FBQzthQUNILENBQUM7U0FDSCxDQUFDLENBQUMsQ0FBQztRQUVKLE9BQU87UUFDUCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLEVBQUU7WUFDdkMsa0JBQWtCLEVBQUU7Z0JBQ2xCO29CQUNFLE1BQU0sRUFBRSxPQUFPO29CQUNmLFNBQVMsRUFBRSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUUsZUFBZSxDQUFFLEVBQUU7b0JBQ3RELFVBQVUsRUFBRSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUUsOEJBQThCLENBQUUsRUFBRTtvQkFDdEUsT0FBTyxFQUFFLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsQ0FBRSxnQkFBZ0IsQ0FBRSxFQUFFO2lCQUN0RDthQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUVELHNFQUFzRSxDQUFDLElBQVU7UUFDL0UsS0FBSyxNQUFNLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRSxPQUFPLEVB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O1FBRUgsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2QsQ0FBQztDQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0IH0gZnJvbSAnbm9kZXVuaXQnO1xuaW1wb3J0IHsgZGlmZlRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vbGliJztcbmltcG9ydCB7IHBvbGRvYywgcG9saWN5LCByZXNvdXJjZSwgcm9sZSwgdGVtcGxhdGUgfSBmcm9tICcuLi91dGlsJztcblxuZXhwb3J0ID0ge1xuICAnc2hvd3MgbmV3IEFzc3VtZVJvbGVQb2xpY3lEb2N1bWVudCcodGVzdDogVGVzdCkge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBkaWZmID0gZGlmZlRlbXBsYXRlKHt9LCB0ZW1wbGF0ZSh7XG4gICAgICBNeVJvbGU6IHJvbGUoe1xuICAgICAgICBBc3N1bWVSb2xlUG9saWN5RG9jdW1lbnQ6IHBvbGRvYyh7XG4gICAgICAgICAgQWN0aW9uOiAnc3RzOkFzc3VtZVJvbGUnLFxuICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICBQcmluY2lwYWw6IHsgU2VydmljZTogJ2xhbWJkYS5hbWF6b25hd3MuY29tJyB9XG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0pKTtcblxuICAgIC8vIFRIRU5cbiAgICB0ZXN0LmRlZXBFcXVhbChkaWZmLmlhbUNoYW5nZXMudG9Kc29uKCksIHtcbiAgICAgIHN0YXRlbWVudEFkZGl0aW9uczogW1xuICAgICAgICB7XG4gICAgICAgICAgZWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgIHJlc291cmNlczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJyR7TXlSb2xlLkFybn0nIF0gfSxcbiAgICAgICAgICBwcmluY2lwYWxzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnU2VydmljZTpsYW1iZGEuYW1hem9uYXdzLmNvbScgXSB9LFxuICAgICAgICAgIGFjdGlvbnM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdzdHM6QXNzdW1lUm9sZScgXSB9LFxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnaW1wbGljaXRseSBrbm93cyBwcmluY2lwYWwgb2YgaWRlbnRpdHkgcG9saWN5IGZvciBhbGwgcmVzb3VyY2UgdHlwZXMnKHRlc3Q6IFRlc3QpIHtcbiAgICBmb3IgKGNvbnN0IGF0dHIgb2YgWydSb2xlcycsICdVc2VycycsICdHcm91cHMnXSkge1xuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgZGlmZiA9IGRpZmZUZW1wbGF0ZSh7fSwgdGVtcGxhdGUoe1xuICAgICAgICBNeVBvbGljeTogcG9saWN5KHtcbiAgICAgICAgICBbYXR0cl06IFt7IFJlZjogJ015Um9sZScgfV0sXG4gICAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHBvbGRvYyh7XG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICBBY3Rpb246ICdzMzpEb1RoYXRUaGluZycsXG4gICAgICAgICAgICBSZXNvdXJjZTogJyonXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgIH0pKTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgdGVzdC5kZWVwRXF1YWwoZGlmZi5pYW1DaGFuZ2VzLnRvSnNvbigpLCB7XG4gICAgICAgIHN0YXRlbWVudEFkZGl0aW9uczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgIHJlc291cmNlczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJyonIF0gfSxcbiAgICAgICAgICAgIHByaW5jaXBhbHM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdBV1M6JHtNeVJvbGV9JyBdIH0sXG4gICAgICAgICAgICBhY3Rpb25zOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnczM6RG9UaGF0VGhpbmcnIF0gfSxcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdwb2xpY2llcyBvbiBhbiBpZGVudGl0eSBvYmplY3QnKHRlc3Q6IFRlc3QpIHtcbiAgICBmb3IgKGNvbnN0IHJlc291cmNlVHlwZSBvZiBbJ1JvbGUnLCAnVXNlcicsICdHcm91cCddKSB7XG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBkaWZmID0gZGlmZlRlbXBsYXRlKHt9LCB0ZW1wbGF0ZSh7XG4gICAgICAgIE15SWRlbnRpdHk6IHJlc291cmNlKGBBV1M6OklBTTo6JHtyZXNvdXJjZVR5cGV9YCwge1xuICAgICAgICAgIFBvbGljaWVzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFBvbGljeU5hbWU6ICdQb2xseScsXG4gICAgICAgICAgICAgIFBvbGljeURvY3VtZW50OiBwb2xkb2Moe1xuICAgICAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgICAgICBBY3Rpb246ICdzMzpEb1RoYXRUaGluZycsXG4gICAgICAgICAgICAgICAgUmVzb3VyY2U6ICcqJ1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgIH0pXG4gICAgICB9KSk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIHRlc3QuZGVlcEVxdWFsKGRpZmYuaWFtQ2hhbmdlcy50b0pzb24oKSwge1xuICAgICAgICBzdGF0ZW1lbnRBZGRpdGlvbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBlZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICByZXNvdXJjZXM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICcqJyBdIH0sXG4gICAgICAgICAgICBwcmluY2lwYWxzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnQVdTOiR7TXlJZGVudGl0eX0nIF0gfSxcbiAgICAgICAgICAgIGFjdGlvbnM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdzMzpEb1RoYXRUaGluZycgXSB9LFxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ2lmIHBvbGljeSBpcyBhdHRhY2hlZCB0byBtdWx0aXBsZSByb2xlcyBhbGwgYXJlIHNob3duJyh0ZXN0OiBUZXN0KSB7XG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUoe30sIHRlbXBsYXRlKHtcbiAgICAgIE15UG9saWN5OiBwb2xpY3koe1xuICAgICAgICBSb2xlczogW3sgUmVmOiAnTXlSb2xlJyB9LCB7IFJlZjogJ1RoeVJvbGUnIH1dLFxuICAgICAgICBQb2xpY3lEb2N1bWVudDogcG9sZG9jKHtcbiAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgQWN0aW9uOiAnczM6RG9UaGF0VGhpbmcnLFxuICAgICAgICAgIFJlc291cmNlOiAnKidcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIHRlc3QuZGVlcEVxdWFsKGRpZmYuaWFtQ2hhbmdlcy50b0pzb24oKSwge1xuICAgICAgc3RhdGVtZW50QWRkaXRpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBlZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnKicgXSB9LFxuICAgICAgICAgIHByaW5jaXBhbHM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdBV1M6JHtNeVJvbGV9JyBdIH0sXG4gICAgICAgICAgYWN0aW9uczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJ3MzOkRvVGhhdFRoaW5nJyBdIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBlZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnKicgXSB9LFxuICAgICAgICAgIHByaW5jaXBhbHM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdBV1M6JHtUaHlSb2xlfScgXSB9LFxuICAgICAgICAgIGFjdGlvbnM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdzMzpEb1RoYXRUaGluZycgXSB9LFxuICAgICAgICB9LFxuICAgICAgXVxuICAgIH0pO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ2NvcnJlY3RseSBwYXJzZXMgTGFtYmRhIHBlcm1pc3Npb25zJyh0ZXN0OiBUZXN0KSB7XG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUoe30sIHRlbXBsYXRlKHtcbiAgICAgIE15UGVybWlzc2lvbjogcmVzb3VyY2UoJ0FXUzo6TGFtYmRhOjpQZXJtaXNzaW9uJywge1xuICAgICAgICBBY3Rpb246ICdsYW1iZGE6SW52b2tlRnVuY3Rpb24nLFxuICAgICAgICBGdW5jdGlvbk5hbWU6IHsgUmVmOiAnTXlGdW5jdGlvbicgfSxcbiAgICAgICAgUHJpbmNpcGFsOiAnczMuYW1hem9uYXdzLmNvbScsXG4gICAgICAgIFNvdXJjZUFjY291bnQ6IHtSZWY6ICdBV1M6OkFjY291bnRJZCcgfSxcbiAgICAgICAgU291cmNlQXJuOiB7J0ZuOjpHZXRBdHQnOiBbJ015QnVja2V0RjY4RjNGRjAnLCAnQXJuJ119LFxuICAgICAgfSlcbiAgICB9KSk7XG5cbiAgICAvLyBUSEVOXG4gICAgdGVzdC5kZWVwRXF1YWwoZGlmZi5pYW1DaGFuZ2VzLnRvSnNvbigpLCB7XG4gICAgICBzdGF0ZW1lbnRBZGRpdGlvbnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICByZXNvdXJjZXM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICcke015RnVuY3Rpb259JyBdIH0sXG4gICAgICAgICAgcHJpbmNpcGFsczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJ1NlcnZpY2U6czMuYW1hem9uYXdzLmNvbScgXSB9LFxuICAgICAgICAgIGFjdGlvbnM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdsYW1iZGE6SW52b2tlRnVuY3Rpb24nIF0gfSxcbiAgICAgICAgICBjb25kaXRpb246IHtcbiAgICAgICAgICAgIFN0cmluZ0VxdWFsczogeyAnQVdTOlNvdXJjZUFjY291bnQnOiAnJHtBV1M6OkFjY291bnRJZH0nIH0sXG4gICAgICAgICAgICBBcm5MaWtlOiB7ICdBV1M6U291cmNlQXJuJzogJyR7TXlCdWNrZXRGNjhGM0ZGMC5Bcm59JyB9XG4gICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH0pO1xuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdpbXBsaWNpdGx5IGtub3dzIHJlc291cmNlIG9mIChxdWV1ZSkgcmVzb3VyY2UgcG9saWN5IGV2ZW4gaWYgKiBnaXZlbicodGVzdDogVGVzdCkge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBkaWZmID0gZGlmZlRlbXBsYXRlKHt9LCB0ZW1wbGF0ZSh7XG4gICAgICBRdWV1ZVBvbGljeTogcmVzb3VyY2UoJ0FXUzo6U1FTOjpRdWV1ZVBvbGljeScsIHtcbiAgICAgICAgUXVldWVzOiBbIHsgUmVmOiAnTXlRdWV1ZScgfSBdLFxuICAgICAgICBQb2xpY3lEb2N1bWVudDogcG9sZG9jKHtcbiAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgQWN0aW9uOiAnc3FzOlNlbmRNZXNzYWdlJyxcbiAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgIFByaW5jaXBhbDogeyBTZXJ2aWNlOiAnc25zLmFtYXpvbmF3cy5jb20nIH1cbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIHRlc3QuZGVlcEVxdWFsKGRpZmYuaWFtQ2hhbmdlcy50b0pzb24oKSwge1xuICAgICAgc3RhdGVtZW50QWRkaXRpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBlZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnJHtNeVF1ZXVlfScgXSB9LFxuICAgICAgICAgIHByaW5jaXBhbHM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdTZXJ2aWNlOnNucy5hbWF6b25hd3MuY29tJyBdIH0sXG4gICAgICAgICAgYWN0aW9uczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJ3NxczpTZW5kTWVzc2FnZScgXSB9LFxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnZmluZHMgc29sZSBzdGF0ZW1lbnQgcmVtb3ZhbHMnKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3QgZGlmZiA9IGRpZmZUZW1wbGF0ZSh0ZW1wbGF0ZSh7XG4gICAgICBCdWNrZXRQb2xpY3k6IHJlc291cmNlKCdBV1M6OlMzOjpCdWNrZXRQb2xpY3knLCB7XG4gICAgICAgIEJ1Y2tldDogeyBSZWY6ICdNeUJ1Y2tldCcgfSxcbiAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHBvbGRvYyh7XG4gICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgIEFjdGlvbjogJ3MzOlB1dE9iamVjdCcsXG4gICAgICAgICAgUmVzb3VyY2U6ICcqJyxcbiAgICAgICAgICBQcmluY2lwYWw6IHsgQVdTOiAnbWUnIH1cbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSksIHt9KTtcblxuICAgIC8vIFRIRU5cbiAgICB0ZXN0LmRlZXBFcXVhbChkaWZmLmlhbUNoYW5nZXMudG9Kc29uKCksIHtcbiAgICAgIHN0YXRlbWVudFJlbW92YWxzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBlZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnJHtNeUJ1Y2tldH0nIF0gfSxcbiAgICAgICAgICBwcmluY2lwYWxzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnQVdTOm1lJyBdIH0sXG4gICAgICAgICAgYWN0aW9uczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJ3MzOlB1dE9iamVjdCcgXSB9LFxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnZmluZHMgb25lIG9mIG1hbnkgc3RhdGVtZW50IHJlbW92YWxzJyh0ZXN0OiBUZXN0KSB7XG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUoXG4gICAgICB0ZW1wbGF0ZSh7XG4gICAgICAgIEJ1Y2tldFBvbGljeTogcmVzb3VyY2UoJ0FXUzo6UzM6OkJ1Y2tldFBvbGljeScsIHtcbiAgICAgICAgICBCdWNrZXQ6IHsgUmVmOiAnTXlCdWNrZXQnIH0sXG4gICAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHBvbGRvYyh7XG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICBBY3Rpb246ICdzMzpQdXRPYmplY3QnLFxuICAgICAgICAgICAgUmVzb3VyY2U6ICcqJyxcbiAgICAgICAgICAgIFByaW5jaXBhbDogeyBBV1M6ICdtZScgfVxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgIEFjdGlvbjogJ3MzOkxvb2tBdE9iamVjdCcsXG4gICAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgICAgUHJpbmNpcGFsOiB7IEFXUzogJ21lJyB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgIH0pLFxuICAgICAgdGVtcGxhdGUoe1xuICAgICAgICBCdWNrZXRQb2xpY3k6IHJlc291cmNlKCdBV1M6OlMzOjpCdWNrZXRQb2xpY3knLCB7XG4gICAgICAgICAgQnVja2V0OiB7IFJlZjogJ015QnVja2V0JyB9LFxuICAgICAgICAgIFBvbGljeURvY3VtZW50OiBwb2xkb2Moe1xuICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgQWN0aW9uOiAnczM6TG9va0F0T2JqZWN0JyxcbiAgICAgICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICAgICAgICBQcmluY2lwYWw6IHsgQVdTOiAnbWUnIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgfSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIHRlc3QuZGVlcEVxdWFsKGRpZmYuaWFtQ2hhbmdlcy50b0pzb24oKSwge1xuICAgICAgc3RhdGVtZW50UmVtb3ZhbHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICByZXNvdXJjZXM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICcke015QnVja2V0fScgXSB9LFxuICAgICAgICAgIHByaW5jaXBhbHM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdBV1M6bWUnIF0gfSxcbiAgICAgICAgICBhY3Rpb25zOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnczM6UHV0T2JqZWN0JyBdIH0sXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KTtcblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdmaW5kcyBwb2xpY3kgYXR0YWNobWVudHMnKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3QgZGlmZiA9IGRpZmZUZW1wbGF0ZSh7fSwgdGVtcGxhdGUoe1xuICAgICAgU29tZVJvbGU6IHJlc291cmNlKCdBV1M6OklBTTo6Um9sZScsIHtcbiAgICAgICAgTWFuYWdlZFBvbGljeUFybnM6IFsnYXJuOnBvbGljeSddLFxuICAgICAgfSlcbiAgICB9KSk7XG5cbiAgICAvLyBUSEVOXG4gICAgdGVzdC5kZWVwRXF1YWwoZGlmZi5pYW1DaGFuZ2VzLnRvSnNvbigpLCB7XG4gICAgICBtYW5hZ2VkUG9saWN5QWRkaXRpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZGVudGl0eUFybjogJyR7U29tZVJvbGV9JyxcbiAgICAgICAgICBtYW5hZ2VkUG9saWN5QXJuOiAnYXJuOnBvbGljeSdcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH0pO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ2ZpbmRzIHBvbGljeSByZW1vdmFscycodGVzdDogVGVzdCkge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBkaWZmID0gZGlmZlRlbXBsYXRlKFxuICAgICAgdGVtcGxhdGUoe1xuICAgICAgICBTb21lUm9sZTogcmVzb3VyY2UoJ0FXUzo6SUFNOjpSb2xlJywge1xuICAgICAgICAgIE1hbmFnZWRQb2xpY3lBcm5zOiBbJ2Fybjpwb2xpY3knLCAnYXJuOnBvbGljeTInXSxcbiAgICAgICAgfSlcbiAgICAgIH0pLFxuICAgICAgdGVtcGxhdGUoe1xuICAgICAgICBTb21lUm9sZTogcmVzb3VyY2UoJ0FXUzo6SUFNOjpSb2xlJywge1xuICAgICAgICAgIE1hbmFnZWRQb2xpY3lBcm5zOiBbJ2Fybjpwb2xpY3kyJ10sXG4gICAgICAgIH0pXG4gICAgfSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIHRlc3QuZGVlcEVxdWFsKGRpZmYuaWFtQ2hhbmdlcy50b0pzb24oKSwge1xuICAgICAgbWFuYWdlZFBvbGljeVJlbW92YWxzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZGVudGl0eUFybjogJyR7U29tZVJvbGV9JyxcbiAgICAgICAgICBtYW5hZ2VkUG9saWN5QXJuOiAnYXJuOnBvbGljeSdcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH0pO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ3F1ZXVlcG9saWN5IHF1ZXVlIGNoYW5nZSBjb3VudHMgYXMgcmVtb3ZhbCthZGRpdGlvbicodGVzdDogVGVzdCkge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBkaWZmID0gZGlmZlRlbXBsYXRlKHRlbXBsYXRlKHtcbiAgICAgIFF1ZXVlUG9saWN5OiByZXNvdXJjZSgnQVdTOjpTUVM6OlF1ZXVlUG9saWN5Jywge1xuICAgICAgICBRdWV1ZXM6IFsgeyBSZWY6ICdNeVF1ZXVlMScgfSBdLFxuICAgICAgICBQb2xpY3lEb2N1bWVudDogcG9sZG9jKHtcbiAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgQWN0aW9uOiAnc3FzOlNlbmRNZXNzYWdlJyxcbiAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgIFByaW5jaXBhbDogeyBTZXJ2aWNlOiAnc25zLmFtYXpvbmF3cy5jb20nIH1cbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSksIHRlbXBsYXRlKHtcbiAgICAgIFF1ZXVlUG9saWN5OiByZXNvdXJjZSgnQVdTOjpTUVM6OlF1ZXVlUG9saWN5Jywge1xuICAgICAgICBRdWV1ZXM6IFsgeyBSZWY6ICdNeVF1ZXVlMicgfSBdLFxuICAgICAgICBQb2xpY3lEb2N1bWVudDogcG9sZG9jKHtcbiAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgQWN0aW9uOiAnc3FzOlNlbmRNZXNzYWdlJyxcbiAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgIFByaW5jaXBhbDogeyBTZXJ2aWNlOiAnc25zLmFtYXpvbmF3cy5jb20nIH1cbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIHRlc3QuZGVlcEVxdWFsKGRpZmYuaWFtQ2hhbmdlcy50b0pzb24oKSwge1xuICAgICAgc3RhdGVtZW50QWRkaXRpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBlZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnJHtNeVF1ZXVlMn0nIF0gfSxcbiAgICAgICAgICBwcmluY2lwYWxzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnU2VydmljZTpzbnMuYW1hem9uYXdzLmNvbScgXSB9LFxuICAgICAgICAgIGFjdGlvbnM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdzcXM6U2VuZE1lc3NhZ2UnIF0gfSxcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIHN0YXRlbWVudFJlbW92YWxzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBlZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnJHtNeVF1ZXVlMX0nIF0gfSxcbiAgICAgICAgICBwcmluY2lwYWxzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnU2VydmljZTpzbnMuYW1hem9uYXdzLmNvbScgXSB9LFxuICAgICAgICAgIGFjdGlvbnM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdzcXM6U2VuZE1lc3NhZ2UnIF0gfSxcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH0pO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG59OyJdfQ==