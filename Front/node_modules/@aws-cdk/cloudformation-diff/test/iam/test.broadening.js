"use strict";
const lib_1 = require("../../lib");
const util_1 = require("../util");
module.exports = {
    'broadening is': {
        'adding of positive statements'(test) {
            // WHEN
            const diff = lib_1.diffTemplate({}, util_1.template({
                QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
                    Queues: [{ Ref: 'MyQueue' }],
                    PolicyDocument: util_1.poldoc({
                        Effect: 'Allow',
                        Action: 'sqs:SendMessage',
                        Resource: '*',
                        Principal: { Service: 'sns.amazonaws.com' }
                    })
                })
            }));
            // THEN
            test.equal(diff.permissionsBroadened, true);
            test.done();
        },
        'adding of positive statements to an existing policy'(test) {
            // WHEN
            const diff = lib_1.diffTemplate(util_1.template({
                QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
                    Queues: [{ Ref: 'MyQueue' }],
                    PolicyDocument: util_1.poldoc({
                        Effect: 'Allow',
                        Action: 'sqs:SendMessage',
                        Resource: '*',
                        Principal: { Service: 'sns.amazonaws.com' }
                    })
                })
            }), util_1.template({
                QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
                    Queues: [{ Ref: 'MyQueue' }],
                    PolicyDocument: util_1.poldoc({
                        Effect: 'Allow',
                        Action: 'sqs:SendMessage',
                        Resource: '*',
                        Principal: { Service: 'sns.amazonaws.com' }
                    }, {
                        Effect: 'Allow',
                        Action: 'sqs:LookAtMessage',
                        Resource: '*',
                        Principal: { Service: 'sns.amazonaws.com' }
                    })
                })
            }));
            // THEN
            test.equal(diff.permissionsBroadened, true);
            test.done();
        },
        'removal of not-statements'(test) {
            // WHEN
            const diff = lib_1.diffTemplate(util_1.template({
                QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
                    Queues: [{ Ref: 'MyQueue' }],
                    PolicyDocument: util_1.poldoc({
                        Effect: 'Allow',
                        Action: 'sqs:SendMessage',
                        Resource: '*',
                        NotPrincipal: { Service: 'sns.amazonaws.com' }
                    })
                })
            }), {});
            // THEN
            test.equal(diff.permissionsBroadened, true);
            test.done();
        },
        'changing of resource target'(test) {
            // WHEN
            const diff = lib_1.diffTemplate(util_1.template({
                QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
                    Queues: [{ Ref: 'MyQueue' }],
                    PolicyDocument: util_1.poldoc({
                        Effect: 'Allow',
                        Action: 'sqs:SendMessage',
                        Resource: '*',
                        Principal: { Service: 'sns.amazonaws.com' }
                    })
                })
            }), util_1.template({
                QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
                    Queues: [{ Ref: 'MyOtherQueue' }],
                    PolicyDocument: util_1.poldoc({
                        Effect: 'Allow',
                        Action: 'sqs:SendMessage',
                        Resource: '*',
                        Principal: { Service: 'sns.amazonaws.com' }
                    })
                })
            }));
            // THEN
            test.equal(diff.permissionsBroadened, true);
            test.done();
        },
        'addition of ingress rules'(test) {
            // WHEN
            const diff = lib_1.diffTemplate(util_1.template({}), util_1.template({
                SG: util_1.resource('AWS::EC2::SecurityGroup', {
                    SecurityGroupIngress: [
                        {
                            CidrIp: '1.2.3.4/8',
                            FromPort: 80,
                            ToPort: 80,
                            IpProtocol: 'tcp',
                        }
                    ],
                })
            }));
            // THEN
            test.equal(diff.permissionsBroadened, true);
            test.done();
        },
        'addition of egress rules'(test) {
            // WHEN
            const diff = lib_1.diffTemplate(util_1.template({}), util_1.template({
                SG: util_1.resource('AWS::EC2::SecurityGroup', {
                    SecurityGroupEgress: [
                        {
                            DestinationSecurityGroupId: { 'Fn::GetAtt': ['ThatOtherGroup', 'GroupId'] },
                            FromPort: 80,
                            ToPort: 80,
                            IpProtocol: 'tcp',
                        }
                    ],
                })
            }));
            // THEN
            test.equal(diff.permissionsBroadened, true);
            test.done();
        },
    },
    'broadening is not': {
        'removal of positive statements from an existing policy'(test) {
            // WHEN
            const diff = lib_1.diffTemplate(util_1.template({
                QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
                    Queues: [{ Ref: 'MyQueue' }],
                    PolicyDocument: util_1.poldoc({
                        Effect: 'Allow',
                        Action: 'sqs:SendMessage',
                        Resource: '*',
                        Principal: { Service: 'sns.amazonaws.com' }
                    }, {
                        Effect: 'Allow',
                        Action: 'sqs:LookAtMessage',
                        Resource: '*',
                        Principal: { Service: 'sns.amazonaws.com' }
                    })
                })
            }), util_1.template({
                QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
                    Queues: [{ Ref: 'MyQueue' }],
                    PolicyDocument: util_1.poldoc({
                        Effect: 'Allow',
                        Action: 'sqs:SendMessage',
                        Resource: '*',
                        Principal: { Service: 'sns.amazonaws.com' }
                    })
                })
            }));
            // THEN
            test.equal(diff.permissionsBroadened, false);
            test.done();
        },
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5icm9hZGVuaW5nLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidGVzdC5icm9hZGVuaW5nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxtQ0FBeUM7QUFDekMsa0NBQXFEO0FBRXJELGlCQUFTO0lBQ1AsZUFBZSxFQUFFO1FBQ2YsK0JBQStCLENBQUMsSUFBVTtZQUN4QyxPQUFPO1lBQ1AsTUFBTSxJQUFJLEdBQUcsa0JBQVksQ0FBQyxFQUFFLEVBQUUsZUFBUSxDQUFDO2dCQUNyQyxXQUFXLEVBQUUsZUFBUSxDQUFDLHVCQUF1QixFQUFFO29CQUM3QyxNQUFNLEVBQUUsQ0FBRSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsQ0FBRTtvQkFDOUIsY0FBYyxFQUFFLGFBQU0sQ0FBQzt3QkFDckIsTUFBTSxFQUFFLE9BQU87d0JBQ2YsTUFBTSxFQUFFLGlCQUFpQjt3QkFDekIsUUFBUSxFQUFFLEdBQUc7d0JBQ2IsU0FBUyxFQUFFLEVBQUUsT0FBTyxFQUFFLG1CQUFtQixFQUFFO3FCQUM1QyxDQUFDO2lCQUNILENBQUM7YUFDSCxDQUFDLENBQUMsQ0FBQztZQUVKLE9BQU87WUFDUCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUU1QyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDZCxDQUFDO1FBRUQscURBQXFELENBQUMsSUFBVTtZQUM5RCxPQUFPO1lBQ1AsTUFBTSxJQUFJLEdBQUcsa0JBQVksQ0FBQyxlQUFRLENBQUM7Z0JBQ2pDLFdBQVcsRUFBRSxlQUFRLENBQUMsdUJBQXVCLEVBQUU7b0JBQzdDLE1BQU0sRUFBRSxDQUFFLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxDQUFFO29CQUM5QixjQUFjLEVBQUUsYUFBTSxDQUNwQjt3QkFDRSxNQUFNLEVBQUUsT0FBTzt3QkFDZixNQUFNLEVBQUUsaUJBQWlCO3dCQUN6QixRQUFRLEVBQUUsR0FBRzt3QkFDYixT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ZGlmZlRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vbGliJztcbmltcG9ydCB7IHBvbGRvYywgcmVzb3VyY2UsIHRlbXBsYXRlIH0gZnJvbSAnLi4vdXRpbCc7XG5cbmV4cG9ydCA9IHtcbiAgJ2Jyb2FkZW5pbmcgaXMnOiB7XG4gICAgJ2FkZGluZyBvZiBwb3NpdGl2ZSBzdGF0ZW1lbnRzJyh0ZXN0OiBUZXN0KSB7XG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBkaWZmID0gZGlmZlRlbXBsYXRlKHt9LCB0ZW1wbGF0ZSh7XG4gICAgICAgIFF1ZXVlUG9saWN5OiByZXNvdXJjZSgnQVdTOjpTUVM6OlF1ZXVlUG9saWN5Jywge1xuICAgICAgICAgIFF1ZXVlczogWyB7IFJlZjogJ015UXVldWUnIH0gXSxcbiAgICAgICAgICBQb2xpY3lEb2N1bWVudDogcG9sZG9jKHtcbiAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgIEFjdGlvbjogJ3NxczpTZW5kTWVzc2FnZScsXG4gICAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgICAgUHJpbmNpcGFsOiB7IFNlcnZpY2U6ICdzbnMuYW1hem9uYXdzLmNvbScgfVxuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICB9KSk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIHRlc3QuZXF1YWwoZGlmZi5wZXJtaXNzaW9uc0Jyb2FkZW5lZCwgdHJ1ZSk7XG5cbiAgICAgIHRlc3QuZG9uZSgpO1xuICAgIH0sXG5cbiAgICAnYWRkaW5nIG9mIHBvc2l0aXZlIHN0YXRlbWVudHMgdG8gYW4gZXhpc3RpbmcgcG9saWN5Jyh0ZXN0OiBUZXN0KSB7XG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBkaWZmID0gZGlmZlRlbXBsYXRlKHRlbXBsYXRlKHtcbiAgICAgICAgUXVldWVQb2xpY3k6IHJlc291cmNlKCdBV1M6OlNRUzo6UXVldWVQb2xpY3knLCB7XG4gICAgICAgICAgUXVldWVzOiBbIHsgUmVmOiAnTXlRdWV1ZScgfSBdLFxuICAgICAgICAgIFBvbGljeURvY3VtZW50OiBwb2xkb2MoXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgICAgQWN0aW9uOiAnc3FzOlNlbmRNZXNzYWdlJyxcbiAgICAgICAgICAgICAgUmVzb3VyY2U6ICcqJyxcbiAgICAgICAgICAgICAgUHJpbmNpcGFsOiB7IFNlcnZpY2U6ICdzbnMuYW1hem9uYXdzLmNvbScgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIClcbiAgICAgICAgfSlcbiAgICAgIH0pLCB0ZW1wbGF0ZSh7XG4gICAgICAgIFF1ZXVlUG9saWN5OiByZXNvdXJjZSgnQVdTOjpTUVM6OlF1ZXVlUG9saWN5Jywge1xuICAgICAgICAgIFF1ZXVlczogWyB7IFJlZjogJ015UXVldWUnIH0gXSxcbiAgICAgICAgICBQb2xpY3lEb2N1bWVudDogcG9sZG9jKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICAgIEFjdGlvbjogJ3NxczpTZW5kTWVzc2FnZScsXG4gICAgICAgICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICAgICAgICAgIFByaW5jaXBhbDogeyBTZXJ2aWNlOiAnc25zLmFtYXpvbmF3cy5jb20nIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgICAgQWN0aW9uOiAnc3FzOkxvb2tBdE1lc3NhZ2UnLFxuICAgICAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgICAgICBQcmluY2lwYWw6IHsgU2VydmljZTogJ3Nucy5hbWF6b25hd3MuY29tJyB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKVxuICAgICAgICB9KVxuICAgICAgfSkpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICB0ZXN0LmVxdWFsKGRpZmYucGVybWlzc2lvbnNCcm9hZGVuZWQsIHRydWUpO1xuXG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuXG4gICAgJ3JlbW92YWwgb2Ygbm90LXN0YXRlbWVudHMnKHRlc3Q6IFRlc3QpIHtcbiAgICAgIC8vIFdIRU5cbiAgICAgIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUodGVtcGxhdGUoe1xuICAgICAgICBRdWV1ZVBvbGljeTogcmVzb3VyY2UoJ0FXUzo6U1FTOjpRdWV1ZVBvbGljeScsIHtcbiAgICAgICAgICBRdWV1ZXM6IFsgeyBSZWY6ICdNeVF1ZXVlJyB9IF0sXG4gICAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHBvbGRvYyh7XG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICBBY3Rpb246ICdzcXM6U2VuZE1lc3NhZ2UnLFxuICAgICAgICAgICAgUmVzb3VyY2U6ICcqJyxcbiAgICAgICAgICAgIE5vdFByaW5jaXBhbDogeyBTZXJ2aWNlOiAnc25zLmFtYXpvbmF3cy5jb20nIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgfSksIHt9KTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgdGVzdC5lcXVhbChkaWZmLnBlcm1pc3Npb25zQnJvYWRlbmVkLCB0cnVlKTtcblxuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcblxuICAgICdjaGFuZ2luZyBvZiByZXNvdXJjZSB0YXJnZXQnKHRlc3Q6IFRlc3QpIHtcbiAgICAgIC8vIFdIRU5cbiAgICAgIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUodGVtcGxhdGUoe1xuICAgICAgICBRdWV1ZVBvbGljeTogcmVzb3VyY2UoJ0FXUzo6U1FTOjpRdWV1ZVBvbGljeScsIHtcbiAgICAgICAgICBRdWV1ZXM6IFsgeyBSZWY6ICdNeVF1ZXVlJyB9IF0sXG4gICAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHBvbGRvYyhcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICBBY3Rpb246ICdzcXM6U2VuZE1lc3NhZ2UnLFxuICAgICAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgICAgICBQcmluY2lwYWw6IHsgU2VydmljZTogJ3Nucy5hbWF6b25hd3MuY29tJyB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKVxuICAgICAgICB9KVxuICAgICAgfSksIHRlbXBsYXRlKHtcbiAgICAgICAgUXVldWVQb2xpY3k6IHJlc291cmNlKCdBV1M6OlNRUzo6UXVldWVQb2xpY3knLCB7XG4gICAgICAgICAgUXVldWVzOiBbIHsgUmVmOiAnTXlPdGhlclF1ZXVlJyB9IF0sXG4gICAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHBvbGRvYyhcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICBBY3Rpb246ICdzcXM6U2VuZE1lc3NhZ2UnLFxuICAgICAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgICAgICBQcmluY2lwYWw6IHsgU2VydmljZTogJ3Nucy5hbWF6b25hd3MuY29tJyB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKVxuICAgICAgICB9KVxuICAgICAgfSkpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICB0ZXN0LmVxdWFsKGRpZmYucGVybWlzc2lvbnNCcm9hZGVuZWQsIHRydWUpO1xuXG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuXG4gICAgJ2FkZGl0aW9uIG9mIGluZ3Jlc3MgcnVsZXMnKHRlc3Q6IFRlc3QpIHtcbiAgICAgIC8vIFdIRU5cbiAgICAgIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUoXG4gICAgICAgIHRlbXBsYXRlKHtcbiAgICAgICAgfSksXG4gICAgICAgIHRlbXBsYXRlKHtcbiAgICAgICAgU0c6IHJlc291cmNlKCdBV1M6OkVDMjo6U2VjdXJpdHlHcm91cCcsIHtcbiAgICAgICAgICBTZWN1cml0eUdyb3VwSW5ncmVzczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBDaWRySXA6ICcxLjIuMy40LzgnLFxuICAgICAgICAgICAgICBGcm9tUG9ydDogODAsXG4gICAgICAgICAgICAgIFRvUG9ydDogODAsXG4gICAgICAgICAgICAgIElwUHJvdG9jb2w6ICd0Y3AnLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgIH0pXG4gICAgICB9KSk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIHRlc3QuZXF1YWwoZGlmZi5wZXJtaXNzaW9uc0Jyb2FkZW5lZCwgdHJ1ZSk7XG5cbiAgICAgIHRlc3QuZG9uZSgpO1xuICAgIH0sXG5cbiAgICAnYWRkaXRpb24gb2YgZWdyZXNzIHJ1bGVzJyh0ZXN0OiBUZXN0KSB7XG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBkaWZmID0gZGlmZlRlbXBsYXRlKFxuICAgICAgICB0ZW1wbGF0ZSh7XG4gICAgICAgIH0pLFxuICAgICAgICB0ZW1wbGF0ZSh7XG4gICAgICAgIFNHOiByZXNvdXJjZSgnQVdTOjpFQzI6OlNlY3VyaXR5R3JvdXAnLCB7XG4gICAgICAgICAgU2VjdXJpdHlHcm91cEVncmVzczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBEZXN0aW5hdGlvblNlY3VyaXR5R3JvdXBJZDogeyAnRm46OkdldEF0dCc6IFsnVGhhdE90aGVyR3JvdXAnLCAnR3JvdXBJZCddIH0sXG4gICAgICAgICAgICAgIEZyb21Qb3J0OiA4MCxcbiAgICAgICAgICAgICAgVG9Qb3J0OiA4MCxcbiAgICAgICAgICAgICAgSXBQcm90b2NvbDogJ3RjcCcsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXSxcbiAgICAgICAgfSlcbiAgICAgIH0pKTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgdGVzdC5lcXVhbChkaWZmLnBlcm1pc3Npb25zQnJvYWRlbmVkLCB0cnVlKTtcblxuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcbiAgfSxcbiAgJ2Jyb2FkZW5pbmcgaXMgbm90Jzoge1xuICAgICdyZW1vdmFsIG9mIHBvc2l0aXZlIHN0YXRlbWVudHMgZnJvbSBhbiBleGlzdGluZyBwb2xpY3knKHRlc3Q6IFRlc3QpIHtcbiAgICAgIC8vIFdIRU5cbiAgICAgIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUodGVtcGxhdGUoe1xuICAgICAgICBRdWV1ZVBvbGljeTogcmVzb3VyY2UoJ0FXUzo6U1FTOjpRdWV1ZVBvbGljeScsIHtcbiAgICAgICAgICBRdWV1ZXM6IFsgeyBSZWY6ICdNeVF1ZXVlJyB9IF0sXG4gICAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHBvbGRvYyhcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICBBY3Rpb246ICdzcXM6U2VuZE1lc3NhZ2UnLFxuICAgICAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgICAgICBQcmluY2lwYWw6IHsgU2VydmljZTogJ3Nucy5hbWF6b25hd3MuY29tJyB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICAgIEFjdGlvbjogJ3NxczpMb29rQXRNZXNzYWdlJyxcbiAgICAgICAgICAgICAgUmVzb3VyY2U6ICcqJyxcbiAgICAgICAgICAgICAgUHJpbmNpcGFsOiB7IFNlcnZpY2U6ICdzbnMuYW1hem9uYXdzLmNvbScgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIClcbiAgICAgICAgfSlcbiAgICAgIH0pLCB0ZW1wbGF0ZSh7XG4gICAgICAgIFF1ZXVlUG9saWN5OiByZXNvdXJjZSgnQVdTOjpTUVM6OlF1ZXVlUG9saWN5Jywge1xuICAgICAgICAgIFF1ZXVlczogWyB7IFJlZjogJ015UXVldWUnIH0gXSxcbiAgICAgICAgICBQb2xpY3lEb2N1bWVudDogcG9sZG9jKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICAgIEFjdGlvbjogJ3NxczpTZW5kTWVzc2FnZScsXG4gICAgICAgICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICAgICAgICAgIFByaW5jaXBhbDogeyBTZXJ2aWNlOiAnc25zLmFtYXpvbmF3cy5jb20nIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICApXG4gICAgICAgIH0pXG4gICAgICB9KSk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIHRlc3QuZXF1YWwoZGlmZi5wZXJtaXNzaW9uc0Jyb2FkZW5lZCwgZmFsc2UpO1xuXG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuICB9XG5cbn07Il19