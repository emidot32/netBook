"use strict";
const fc = require("fast-check");
const security_group_rule_1 = require("../../lib/network/security-group-rule");
const arbitraryRule = fc.record({
    IpProtocol: fc.constantFrom('tcp', 'udp', 'icmp'),
    FromPort: fc.integer(80, 81),
    ToPort: fc.integer(81, 82),
    CidrIp: fc.constantFrom('0.0.0.0/0', '1.2.3.4/8', undefined, undefined),
    DestinationSecurityGroupId: fc.constantFrom('sg-1234', undefined),
    DestinationPrefixListId: fc.constantFrom('pl-1', undefined),
});
const twoArbitraryRules = fc.record({
    rule1: arbitraryRule,
    rule2: arbitraryRule,
    copyIp: fc.boolean(),
    copyFromPort: fc.boolean(),
    copyToPort: fc.boolean(),
    copyCidrIp: fc.boolean(),
    copySecurityGroupId: fc.boolean(),
    copyPrefixListId: fc.boolean(),
}).map(op => {
    const original = op.rule1;
    const modified = Object.create(original, {});
    if (op.copyIp) {
        modified.IpProtocol = op.rule2.IpProtocol;
    }
    if (op.copyFromPort) {
        modified.FromPort = op.rule2.FromPort;
    }
    if (op.copyToPort) {
        modified.ToPort = op.rule2.ToPort;
    }
    if (op.copyCidrIp) {
        modified.CidrIp = op.rule2.CidrIp;
    }
    if (op.copySecurityGroupId) {
        modified.DestinationSecurityGroupId = op.rule2.DestinationSecurityGroupId;
    }
    if (op.copyPrefixListId) {
        modified.DestinationPrefixListId = op.rule2.DestinationPrefixListId;
    }
    return { rule1: original, rule2: modified };
});
module.exports = {
    'can parse cidr-ip'(test) {
        const rule = new security_group_rule_1.SecurityGroupRule({
            GroupId: 'sg-1234',
            IpProtocol: 'tcp',
            FromPort: 10,
            ToPort: 20,
            CidrIp: '1.2.3.4/8',
        });
        test.equal(rule.groupId, 'sg-1234');
        test.equal(rule.ipProtocol, 'tcp');
        test.equal(rule.fromPort, 10);
        test.equal(rule.toPort, 20);
        const peer = rule.peer;
        if (peer.kind !== 'cidr-ip') {
            throw new Error('Fail');
        }
        test.equal(peer.ip, '1.2.3.4/8');
        test.done();
    },
    'can parse cidr-ip 6'(test) {
        const rule = new security_group_rule_1.SecurityGroupRule({
            CidrIpv6: '::0/0'
        });
        const peer = rule.peer;
        if (peer.kind !== 'cidr-ip') {
            throw new Error('Fail');
        }
        test.equal(peer.ip, '::0/0');
        test.done();
    },
    'can parse securityGroup'(test) {
        for (const key of ['DestinationSecurityGroupId', 'SourceSecurityGroupId']) {
            const rule = new security_group_rule_1.SecurityGroupRule({
                [key]: 'sg-1234',
            });
            const peer = rule.peer;
            if (peer.kind !== 'security-group') {
                throw new Error('Fail');
            }
            test.equal(peer.securityGroupId, 'sg-1234');
        }
        test.done();
    },
    'can parse prefixlist'(test) {
        for (const key of ['DestinationPrefixListId', 'SourcePrefixListId']) {
            const rule = new security_group_rule_1.SecurityGroupRule({
                [key]: 'pl-1',
            });
            const peer = rule.peer;
            if (peer.kind !== 'prefix-list') {
                throw new Error('Fail');
            }
            test.equal(peer.prefixListId, 'pl-1');
        }
        test.done();
    },
    'equality is reflexive'(test) {
        fc.assert(fc.property(arbitraryRule, (statement) => {
            return new security_group_rule_1.SecurityGroupRule(statement).equal(new security_group_rule_1.SecurityGroupRule(statement));
        }));
        test.done();
    },
    'equality is symmetric'(test) {
        fc.assert(fc.property(twoArbitraryRules, (s) => {
            const a = new security_group_rule_1.SecurityGroupRule(s.rule1);
            const b = new security_group_rule_1.SecurityGroupRule(s.rule2);
            fc.pre(a.equal(b));
            return b.equal(a);
        }));
        test.done();
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5ydWxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidGVzdC5ydWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxpQ0FBa0M7QUFFbEMsK0VBQTBFO0FBdUYxRSxNQUFNLGFBQWEsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDO0lBQzlCLFVBQVUsRUFBRSxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDO0lBQ2pELFFBQVEsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFDNUIsTUFBTSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUMxQixNQUFNLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxTQUFTLENBQUM7SUFDdkUsMEJBQTBCLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDO0lBQ2pFLHVCQUF1QixFQUFFLEVBQUUsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLFNBQVMsQ0FBQztDQUM1RCxDQUFDLENBQUM7QUFFSCxNQUFNLGlCQUFpQixHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUM7SUFDbEMsS0FBSyxFQUFFLGFBQWE7SUFDcEIsS0FBSyxFQUFFLGFBQWE7SUFDcEIsTUFBTSxFQUFFLEVBQUUsQ0FBQyxPQUFPLEVBQUU7SUFDcEIsWUFBWSxFQUFFLEVBQUUsQ0FBQyxPQUFPLEVBQUU7SUFDMUIsVUFBVSxFQUFHLEVBQUUsQ0FBQyxPQUFPLEVBQUU7SUFDekIsVUFBVSxFQUFFLEVBQUUsQ0FBQyxPQUFPLEVBQUU7SUFDeEIsbUJBQW1CLEVBQUUsRUFBRSxDQUFDLE9BQU8sRUFBRTtJQUNqQyxnQkFBZ0IsRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFO0NBQy9CLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUU7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aUIsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ2xGLENBQUMsQ0FDRixDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDZCxDQUFDO0lBRUQsdUJBQXVCLENBQUMsSUFBVTtRQUNoQyxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQ25CLGlCQUFpQixFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDdkIsTUFBTSxDQUFDLEdBQUcsSUFBSSx1Q0FBaUIsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDekMsTUFBTSxDQUFDLEdBQUcsSUFBSSx1Q0FBaUIsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFekMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkIsT0FBTyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLENBQUMsQ0FDRixDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDZCxDQUFDO0NBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmYyA9IHJlcXVpcmUoJ2Zhc3QtY2hlY2snKTtcbmltcG9ydCB7IFRlc3QgfSBmcm9tICdub2RldW5pdCc7XG5pbXBvcnQgeyBTZWN1cml0eUdyb3VwUnVsZSB9IGZyb20gJy4uLy4uL2xpYi9uZXR3b3JrL3NlY3VyaXR5LWdyb3VwLXJ1bGUnO1xuXG5leHBvcnQgPSB7XG4gICdjYW4gcGFyc2UgY2lkci1pcCcodGVzdDogVGVzdCkge1xuICAgIGNvbnN0IHJ1bGUgPSBuZXcgU2VjdXJpdHlHcm91cFJ1bGUoe1xuICAgICAgR3JvdXBJZDogJ3NnLTEyMzQnLFxuICAgICAgSXBQcm90b2NvbDogJ3RjcCcsXG4gICAgICBGcm9tUG9ydDogMTAsXG4gICAgICBUb1BvcnQ6IDIwLFxuICAgICAgQ2lkcklwOiAnMS4yLjMuNC84JyxcbiAgICB9KTtcblxuICAgIHRlc3QuZXF1YWwocnVsZS5ncm91cElkLCAnc2ctMTIzNCcpO1xuICAgIHRlc3QuZXF1YWwocnVsZS5pcFByb3RvY29sLCAndGNwJyk7XG4gICAgdGVzdC5lcXVhbChydWxlLmZyb21Qb3J0LCAxMCk7XG4gICAgdGVzdC5lcXVhbChydWxlLnRvUG9ydCwgMjApO1xuXG4gICAgY29uc3QgcGVlciA9IHJ1bGUucGVlciE7XG4gICAgaWYgKHBlZXIua2luZCAhPT0gJ2NpZHItaXAnKSB7IHRocm93IG5ldyBFcnJvcignRmFpbCcpOyB9XG4gICAgdGVzdC5lcXVhbChwZWVyLmlwLCAnMS4yLjMuNC84Jyk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnY2FuIHBhcnNlIGNpZHItaXAgNicodGVzdDogVGVzdCkge1xuICAgIGNvbnN0IHJ1bGUgPSBuZXcgU2VjdXJpdHlHcm91cFJ1bGUoe1xuICAgICAgQ2lkcklwdjY6ICc6OjAvMCdcbiAgICB9KTtcblxuICAgIGNvbnN0IHBlZXIgPSBydWxlLnBlZXIhO1xuICAgIGlmIChwZWVyLmtpbmQgIT09ICdjaWRyLWlwJykgeyB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWwnKTsgfVxuICAgIHRlc3QuZXF1YWwocGVlci5pcCwgJzo6MC8wJyk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnY2FuIHBhcnNlIHNlY3VyaXR5R3JvdXAnKHRlc3Q6IFRlc3QpIHtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBbJ0Rlc3RpbmF0aW9uU2VjdXJpdHlHcm91cElkJywgJ1NvdXJjZVNlY3VyaXR5R3JvdXBJZCddKSB7XG4gICAgICBjb25zdCBydWxlID0gbmV3IFNlY3VyaXR5R3JvdXBSdWxlKHtcbiAgICAgICAgW2tleV06ICdzZy0xMjM0JyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBwZWVyID0gcnVsZS5wZWVyITtcbiAgICAgIGlmIChwZWVyLmtpbmQgIT09ICdzZWN1cml0eS1ncm91cCcpIHsgdGhyb3cgbmV3IEVycm9yKCdGYWlsJyk7IH1cbiAgICAgIHRlc3QuZXF1YWwocGVlci5zZWN1cml0eUdyb3VwSWQsICdzZy0xMjM0Jyk7XG4gICAgfVxuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ2NhbiBwYXJzZSBwcmVmaXhsaXN0Jyh0ZXN0OiBUZXN0KSB7XG4gICAgZm9yIChjb25zdCBrZXkgb2YgWydEZXN0aW5hdGlvblByZWZpeExpc3RJZCcsICdTb3VyY2VQcmVmaXhMaXN0SWQnXSkge1xuICAgICAgY29uc3QgcnVsZSA9IG5ldyBTZWN1cml0eUdyb3VwUnVsZSh7XG4gICAgICAgIFtrZXldOiAncGwtMScsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcGVlciA9IHJ1bGUucGVlciE7XG4gICAgICBpZiAocGVlci5raW5kICE9PSAncHJlZml4LWxpc3QnKSB7IHRocm93IG5ldyBFcnJvcignRmFpbCcpOyB9XG4gICAgICB0ZXN0LmVxdWFsKHBlZXIucHJlZml4TGlzdElkLCAncGwtMScpO1xuICAgIH1cblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdlcXVhbGl0eSBpcyByZWZsZXhpdmUnKHRlc3Q6IFRlc3QpIHtcbiAgICBmYy5hc3NlcnQoZmMucHJvcGVydHkoXG4gICAgICBhcmJpdHJhcnlSdWxlLCAoc3RhdGVtZW50KSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgU2VjdXJpdHlHcm91cFJ1bGUoc3RhdGVtZW50KS5lcXVhbChuZXcgU2VjdXJpdHlHcm91cFJ1bGUoc3RhdGVtZW50KSk7XG4gICAgICB9XG4gICAgKSk7XG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ2VxdWFsaXR5IGlzIHN5bW1ldHJpYycodGVzdDogVGVzdCkge1xuICAgIGZjLmFzc2VydChmYy5wcm9wZXJ0eShcbiAgICAgIHR3b0FyYml0cmFyeVJ1bGVzLCAocykgPT4ge1xuICAgICAgICBjb25zdCBhID0gbmV3IFNlY3VyaXR5R3JvdXBSdWxlKHMucnVsZTEpO1xuICAgICAgICBjb25zdCBiID0gbmV3IFNlY3VyaXR5R3JvdXBSdWxlKHMucnVsZTIpO1xuXG4gICAgICAgIGZjLnByZShhLmVxdWFsKGIpKTtcbiAgICAgICAgcmV0dXJuIGIuZXF1YWwoYSk7XG4gICAgICB9XG4gICAgKSk7XG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG59O1xuXG5jb25zdCBhcmJpdHJhcnlSdWxlID0gZmMucmVjb3JkKHtcbiAgSXBQcm90b2NvbDogZmMuY29uc3RhbnRGcm9tKCd0Y3AnLCAndWRwJywgJ2ljbXAnKSxcbiAgRnJvbVBvcnQ6IGZjLmludGVnZXIoODAsIDgxKSxcbiAgVG9Qb3J0OiBmYy5pbnRlZ2VyKDgxLCA4MiksXG4gIENpZHJJcDogZmMuY29uc3RhbnRGcm9tKCcwLjAuMC4wLzAnLCAnMS4yLjMuNC84JywgdW5kZWZpbmVkLCB1bmRlZmluZWQpLFxuICBEZXN0aW5hdGlvblNlY3VyaXR5R3JvdXBJZDogZmMuY29uc3RhbnRGcm9tKCdzZy0xMjM0JywgdW5kZWZpbmVkKSxcbiAgRGVzdGluYXRpb25QcmVmaXhMaXN0SWQ6IGZjLmNvbnN0YW50RnJvbSgncGwtMScsIHVuZGVmaW5lZCksXG59KTtcblxuY29uc3QgdHdvQXJiaXRyYXJ5UnVsZXMgPSBmYy5yZWNvcmQoe1xuICBydWxlMTogYXJiaXRyYXJ5UnVsZSxcbiAgcnVsZTI6IGFyYml0cmFyeVJ1bGUsXG4gIGNvcHlJcDogZmMuYm9vbGVhbigpLFxuICBjb3B5RnJvbVBvcnQ6IGZjLmJvb2xlYW4oKSxcbiAgY29weVRvUG9ydCA6IGZjLmJvb2xlYW4oKSxcbiAgY29weUNpZHJJcDogZmMuYm9vbGVhbigpLFxuICBjb3B5U2VjdXJpdHlHcm91cElkOiBmYy5ib29sZWFuKCksXG4gIGNvcHlQcmVmaXhMaXN0SWQ6IGZjLmJvb2xlYW4oKSxcbn0pLm1hcChvcCA9PiB7XG4gIGNvbnN0IG9yaWdpbmFsID0gb3AucnVsZTE7XG4gIGNvbnN0IG1vZGlmaWVkID0gT2JqZWN0LmNyZWF0ZShvcmlnaW5hbCwge30pO1xuXG4gIGlmIChvcC5jb3B5SXApIHsgbW9kaWZpZWQuSXBQcm90b2NvbCA9IG9wLnJ1bGUyLklwUHJvdG9jb2w7IH1cbiAgaWYgKG9wLmNvcHlGcm9tUG9ydCkgeyBtb2RpZmllZC5Gcm9tUG9ydCA9IG9wLnJ1bGUyLkZyb21Qb3J0OyB9XG4gIGlmIChvcC5jb3B5VG9Qb3J0KSB7IG1vZGlmaWVkLlRvUG9ydCA9IG9wLnJ1bGUyLlRvUG9ydDsgfVxuICBpZiAob3AuY29weUNpZHJJcCkgeyBtb2RpZmllZC5DaWRySXAgPSBvcC5ydWxlMi5DaWRySXA7IH1cbiAgaWYgKG9wLmNvcHlTZWN1cml0eUdyb3VwSWQpIHsgbW9kaWZpZWQuRGVzdGluYXRpb25TZWN1cml0eUdyb3VwSWQgPSBvcC5ydWxlMi5EZXN0aW5hdGlvblNlY3VyaXR5R3JvdXBJZDsgfVxuICBpZiAob3AuY29weVByZWZpeExpc3RJZCkgeyBtb2RpZmllZC5EZXN0aW5hdGlvblByZWZpeExpc3RJZCA9IG9wLnJ1bGUyLkRlc3RpbmF0aW9uUHJlZml4TGlzdElkOyB9XG5cbiAgcmV0dXJuIHsgcnVsZTE6IG9yaWdpbmFsLCBydWxlMjogbW9kaWZpZWQgfTtcbn0pOyJdfQ==